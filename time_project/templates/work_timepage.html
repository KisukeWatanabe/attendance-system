<!-- çµ¦æ–™è¨ˆç®—ç®¡ç† -->
{% extends "base.html" %}
{% block content %}

<div class="mb-4">
    <h2 class="fw-bold mb-0" style="color: var(--primary-color);">çµ¦æ–™è¨ˆç®—ç®¡ç†</h2>
    <p class="text-muted small">å¾“æ¥­å“¡ã”ã¨ã®å‹¤å‹™å®Ÿç¸¾ã¨çµ¦ä¸æ¦‚ç®—ã‚’ç¢ºèªã§ãã¾ã™</p>
</div>

<div class="card border-0 shadow-sm rounded-4 mb-4" style="border: 1px solid #E0D7D5 !important;">
    <div class="card-body p-4">
        <div class="row g-3 align-items-end">
            <div class="col-md-5">
                <label class="form-label small fw-bold" style="color: var(--primary-color);">å¾“æ¥­å“¡ã‚’é¸æŠ</label>
                <select id="user-select" class="form-select rounded-pill border-secondary-subtle">
                    <option value="">å¾“æ¥­å“¡ã‚’é¸ã‚“ã§ãã ã•ã„</option>
                    {% for user in users %}
                    <option value="{{user.id}}" {% if user.id == select_user.id %}selected{% endif %}>{{ user.username }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-5">
                <label class="form-label small fw-bold" style="color: var(--primary-color);">è¡¨ç¤ºå¹´æœˆ</label>
                <div class="input-group">
                    <select id="year-select" class="form-select rounded-start-pill border-secondary-subtle">
                        {% for y in range(current_year - 1, current_year + 6) %}
                        <option value="{{ y }}" {% if y == select_year %}selected{% endif %}>{{ y }}å¹´</option>
                        {% endfor %}
                    </select>
                    <select id="month-select" class="form-select rounded-end-pill border-secondary-subtle">
                        {% for m in range(1, 13) %}
                        <option value="{{ m }}" {% if m == select_month %}selected{% endif %}>{{ m }}æœˆ</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-2 text-end">
                <button class="btn btn-outline-secondary rounded-pill w-100" onclick="window.location.reload();">æ›´æ–°</button>
            </div>
        </div>
    </div>
</div>

<div class="card border-0 shadow-sm rounded-4 mb-5 overflow-hidden" style="border: 1px solid #E0D7D5 !important;">
    <div class="card-header border-0 py-3" style="background-color: #F8F5F2;">
        <h5 class="mb-0 fw-bold" style="color: var(--primary-color);">
            ğŸ’° {{ select_year }}å¹´{{ select_month }}æœˆåˆ† çµ¦ä¸æ¦‚ç®—
        </h5>
    </div>
    <div class="table-responsive">
        <table class="table align-middle mb-0 text-center">
            <thead class="small text-muted bg-light">
                <tr>
                    <th>å‡ºå‹¤æ—¥æ•°</th>
                    <th>ç·å‡ºå‹¤æ™‚é–“</th>
                    <th>æ™‚é–“å¤–</th>
                    <th class="text-primary-emphasis">æ”¯çµ¦é¡ï¼ˆæ¦‚ç®—ï¼‰</th>
                </tr>
            </thead>
            <tbody>
                <tr style="font-size: 1.1rem;">
                    <td><span class="fw-bold">{{ summary.working_days }}</span> <small>æ—¥</small></td>
                    <td><span class="fw-bold">{{ (summary.total_minutes / 60)| int }}</span> <small>h</small> <span class="fw-bold">{{ summary.total_minutes % 60 }}</span> <small>m</small></td>
                    <td class="text-danger"><span class="fw-bold">{{ (summary.overtime_minutes / 60)| int }}</span> <small>h</small></td>
                    <td>
                        <span class="fs-3 fw-bold text-success" style="letter-spacing: -1px;">
                            Â¥ {{ "{:,}".format(summary.basic_salary | round(0, 'floor')) }}
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="card border-0 shadow-sm rounded-4 overflow-hidden" style="border: 1px solid #E0D7D5 !important;">
    <div class="card-header bg-white border-bottom py-3">
        <h5 class="mb-0 fw-bold" style="color: var(--text-color);">å‹¤å‹™è©³ç´°ãƒ­ã‚°</h5>
    </div>
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0 text-center">
            <thead class="small text-muted" style="background-color: #FDFCFB;">
                <tr>
                    <th class="py-3">æ—¥ä»˜</th>
                    <th>å‡ºå‹¤</th>
                    <th>é€€å‹¤</th>
                    <th>ä¼‘æ†©/å¾©å¸°</th>
                    <th>å‹¤å‹™æ™‚é–“</th>
                    <th>æ™‚é–“å¤–</th>
                    <th>æ—¥çµ¦</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody class="small">
                {% for i in range(days_in_period) %}
                {% set current_date = period_start + timedelta(days=i) %}
                {% set data = daily_records.get(current_date) %}
                <tr {% if current_date.weekday() >= 5 %}style="background-color: #FFF9F9;"{% endif %}>
                    <td class="fw-bold text-muted">{{ current_date.strftime('%m/%d') }} <small>({{ ['æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ','æ—¥'][current_date.weekday()] }})</small></td>
                    {% if data %}
                        <td class="fw-bold">{{ data.record.check_in or '-' }}</td>
                        <td class="fw-bold">{{ data.record.check_out or '-' }}</td>
                        <td>
                            <small class="text-muted">{{ data.record.rest_in or '-' }} / {{ data.record.rest_out or '-' }}</small>
                        </td>
                        <td>{{ (data.regular_minutes / 60)| int }}h {{ data.regular_minutes % 60 }}m</td>
                        <td class="text-danger">{{ (data.overtime_minutes / 60)| int }}h</td>
                        <td class="fw-bold text-success">
                            {% if select_user.employment_type == 'parttime' %}
                                Â¥{{ "{:,}".format(data.daily_salary|round(0, 'floor')) }}
                            {% else %}-{% endif %}
                        </td>
                    {% else %}
                        <td colspan="6" class="text-muted italic small">è¨˜éŒ²ãªã—</td>
                    {% endif %}
                    <td>
                        <a href="{{ url_for('main.time_correct', user_id=select_user.id, year=current_date.year, month=current_date.month, day=current_date.day) }}" 
                           class="btn btn-sm btn-outline-secondary rounded-pill px-3">
                            ä¿®æ­£
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    function updatePage() {
        const user_id = document.getElementById('user-select').value;
        const year = document.getElementById('year-select').value;
        const month = document.getElementById('month-select').value;
        const url = new URL(window.location.href);
        url.searchParams.set("year", year);
        url.searchParams.set("month", month);
        url.searchParams.set("user_id", user_id);
        window.location.href = url.toString();
    }
    document.getElementById('user-select').addEventListener('change', updatePage);
    document.getElementById('year-select').addEventListener('change', updatePage);
    document.getElementById('month-select').addEventListener('change', updatePage);
});
</script>

{% endblock %}